import { ref } from "vue";
export default function(options = { clearOldFiles: true }) {
  const files = ref([]);
  const serializeFile = (file) => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        files.value.push({
          ...file,
          name: file.name,
          size: file.size,
          type: file.type,
          lastModified: file.lastModified,
          content: e.target?.result
        });
        resolve();
      };
      reader.onerror = (error) => {
        reject(error);
      };
      reader.readAsDataURL(file);
    });
  };
  const clearFiles = () => {
    files.value.splice(0, files.value.length);
  };
  const handleFileInput = async (event) => {
    if (options.clearOldFiles) {
      clearFiles();
    }
    const promises = [];
    for (const file of event.target.files) {
      promises.push(serializeFile(file));
    }
    await Promise.all(promises);
  };
  return {
    files,
    handleFileInput,
    clearFiles
  };
}
