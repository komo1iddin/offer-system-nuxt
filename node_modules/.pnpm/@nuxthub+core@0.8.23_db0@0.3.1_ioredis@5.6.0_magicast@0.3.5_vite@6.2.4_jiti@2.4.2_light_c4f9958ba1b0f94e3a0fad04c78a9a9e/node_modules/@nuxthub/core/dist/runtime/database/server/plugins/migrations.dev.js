import { applyRemoteDatabaseMigrations, applyRemoteDatabaseQueries } from "../utils/migrations/remote.js";
import { hubHooks } from "../../../base/server/utils/hooks.js";
import { applyDatabaseMigrations, applyDatabaseQueries } from "../utils/migrations/migrations.js";
import { useRuntimeConfig, defineNitroPlugin } from "#imports";
export default defineNitroPlugin(async () => {
  if (!import.meta.dev) return;
  const hub = useRuntimeConfig().hub;
  if (!hub.database) return;
  hubHooks.hookOnce("bindings:ready", async () => {
    if (hub.remote && hub.projectKey) {
      await applyRemoteDatabaseMigrations(hub);
      await applyRemoteDatabaseQueries(hub);
    } else {
      await applyDatabaseMigrations(hub);
      await applyDatabaseQueries(hub);
    }
    await hubHooks.callHookParallel("database:migrations:done");
  });
});
